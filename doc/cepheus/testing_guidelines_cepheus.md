This project is part of FIWARE.

#Cepheus: non functional test guidelines

The IoT Data Edge Consolidation (IDEC) GE addresses the need to process data in real time. Frequently implemented features include filtering, aggregating and merging real-time data from different sources. Thanks to Complex Event Processing (CEP), it is easy for applications to only subscribe to value-added data which is relevant to them. CEP technology is sometimes also referred to as event stream analysis, or real time event correlation.

Cepheus is divided in two simple deployable applications. The first one is a light NGSI broker which features an implementation of the standardized NGSI API. And a CEP which features a dedicated REST management API to configure real time analysis on NGSI events.

##Testing environment

For the testing environment, is needed: 

* A Raspberry Pi for the deployment of the GEri to be tested, Cepheus.
* A machine for with an Orion Context Broker instance. Docker version can be used.
* A machine for JMeter, the tool used to inject load and for simulating the client and collecting the results generated by Cepheus.

##Test execution

###Preliminary setup

Once the HW necessary for the test described previosly at "Testing Environmment" chapter have been setup, the following preliminary steps need to be accomplished before to start the test process:
In order to do the installation of Cepheus, the easiest way is to get the Debian packages, and install them via dpkg. For this, is needed to execute these commands:

    wget -O cepheus-broker.deb "https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&g=com.orange.cepheus&a=cepheus-broker&v=LATEST&p=deb"
    wget -O cepheus-cep.deb "https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&g=com.orange.cepheus&a=cepheus-cep&v=LATEST&p=deb"
    dpkg -i cepheus-broker.deb
    dpkg -i cepheus-cep.deb


This will install both Cepheus Broker and Cepheus CEP.

If changing some of the default configuration is needed, then these files can be edited:

* /etc/cepheus/cep.properties
* /etc/cepheus/broker.properties

In order to start, stop or restart Cepheus CEP, we can use these commands:

`service cepheus-cep start`
`service cepheus-cep stop`
`service cepheus-cep restart`

It's possible to do the same with Cepheus Broker:

`service cepheus-broker start`
`service cepheus-broker stop`
`service cepheus-broker restart`


##Testing step by step

The test of Cepheus must be done in two steps:

1. Script configuration:

There are 4 scripts, one for each scenario.

Host IP and port must be defined. For this purpose, the following User Defined variables in each Jmeter script must be configured:

* HOST -> IP to the host where Cepheus is deployed. Depending on the scenario, this IP has to be Cepheus-CEP or Cepheus-Broker IP (Cepheus-CEP for Cepheus Cep Stress Scenario, and Cepheus-Broker for all the rest).
* PORT -> Port where Cepheus is listening. Depending on the scenario, this port has to be Cepheus-CEP or Cepheus-Broker Port. (Cepheus-CEP for Cepheus Cep Stress Scenario, and Cepheus-Broker for all the rest).

Furthermore, the test duration must be configured. It is recommended to use the planificator from the threads group. The duration for the stress tests was 45 minutes, 75 minutes for the load test, and 6 hours in the stability case.

Finally, in order to get the results, the path to the results file must be configured in the Simple Data Writer from the script.

2. Script execution:

For executing the script, the following command must be typed in the jmeter bin folder:

`./jmeter.sh -n -t /path/to/script/script_name.jmx`

It´s recommended to execute the command in background and nohup mode:

`nohup ./jmeter.sh -n -t /path/to/script/script_name.jmx &`

It´s highly recommended to use a hardware resources monitoring tool, in order to measure things like memory and CPU usages, free memory, etc.

##Expected results

As output from the script, a .dat file (in csv format) is generated. This file can be used for plotting different kinds of charts, like threads number, response times, number of errores, responses per second, etc. A plotting tool (like gnuplot) is needed in order to do this.

Additionally, if a monitoring tool has been used, then different data from it is collected too. Depending on the monitoring tool, it can generate charts directly, or it can be used another tool for plotting the output from monitoring tool (for example, sar from systat library can be used for monitoring, and k-sar tool for plotting the sar output)


