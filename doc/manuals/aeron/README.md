This project is part of [FIWARE](https://www.fiware.org/).


#  IoT Broker: non functional test guidelines #

IoT Broker is the FIWARE reference implementation by the IoT Broker Generic Enabler by NEC and available at its [GitHub repository](https://github.com/Aeronbroker/Aeron). The description of the non functional tests carried out on this implementation is also published via the GitHub repository at [Fiware/test.NonFunctional](https://github.com/fiware/test.NonFunctional/)

## Testing environment ##
The testing environment can be easily set up through a FIWARE Lab, which is based on the cloud operating system OpenStack, and through which it is easy to create and configure a number of machines with the HW [requirements](http://fiware-iot-broker.readthedocs.io/en/latest/installadminguide/index.html#minimum-system-requirements)  required by the GEri installation. Alternatively a different virtualisation system can be adopted as well as to prepare the overall hardware required, namely all the phisical machines needed for the test, which are:

1. A machine for the deployment of the GEri to be tested, Aeron IoT Broker server.
2. A machine for an implementation of the IoT Discovery, that it is a further GE needed for having IoT Broker working properly.
3. A machine for JMeter, the tool used to inject load and for simulating the client and collecting the results generated by Aeron.
4. A machine for a server where to host a custom mock-up (WS application) developed to simulate the missing actors needed by some test scenarios.
 
For example, in the latest test related to version 5.3 of the GEri, all the configured VMs in a dedicated FIWARE Lab were equipped with 2 CPU 2,3 GHz with 4GB RAM and 40 GB HD.


## Test execution ##

###Preliminary setup###

Once the HW necessary for the test described previosly at "Testing Environmment" chapter have been setup, the following preliminary steps need to be accomplished before to start the test process:

1. **Download** the source code to the dedicated server through the command:
	`git clone --branch v5.3.3 https://github.com/Aeronbroker/Aeron.git --single-branch`
2. **Build** the component following the [GEri owner instructions](https://github.com/Aeronbroker/Aeron#building-iot-broker-source-code)
2. **Configure** Aeron IoTBroker following the [GEri owner istructions](https://github.com/Aeronbroker/Aeron#configure-the-iot-broker-with-setup-scripts).
3. **Start** the component with the script in the IoTBroker-runner folder

###Testing step by step###

*coming soon!*



## Expected results ##

These tests are intended to:

- monitor the behavior and **performance** of the API `updateContext` -namely a NGSI-10 operation which represents the push-mode interaction of this GE under a growing workload in order to find its **most production point**.
- assess the **stability** of the API `queryContext` -namely a NGSI-10 operation designed for the synchronous retrieval of data 
- monitor the behavior and **performance** of the API `subscribeContext` -namely a NGSI-10 operation which represents the asynchronous data retrieval interaction of this GEunder a growing workload.

More in detail, these tests involve the assessment of different non functional metrics such as:

1. Response times for <n> concurrent threads
2. Number of responses per second
3. Number of Bytes per second (Throughput)
4. HTTP response codes
5. Error rate
6. Maximum threads number handled
7. CPU usage
8. Memory usage
9. Network traffic

These values can be extracted, on the one hand from the output (CSV file) of the execution of the JMeter test plan file (*.jmx) and its log file (jmeter.log),  on the other hand from a tool for monitoring system resource usage such as [nmon](http://nmon.sourceforge.net/). 