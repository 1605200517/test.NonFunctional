#  PDP AuthZForce: non functional test guidelines #

AuthZForce by Orange is the FIWARE reference implementation of PDP Generic Enabler and it is available at its [GitHub repository](https://github.com/authzforce). The description of the non functional tests carried out on this implementation is also published via the GitHub repository at [Fiware/test.NonFunctional](https://github.com/fiware/test.NonFunctional/)

## Testing environment ##
The testing HW can be easily set up through a FIWARE Lab, which is based on the cloud operating system OpenStack, and through which it is easy to create and configure a number of machines with the environment [requirements](http://authzforce-ce-fiware.readthedocs.io/en/release-5.4.1b/InstallationAndAdministrationGuide.html#system-requirements)  needed by the GEri installation. Alternatively a different virtualisation system can be adopted as well as to prepare the overall hardware required, namely all the phisical machines needed for the test, which are:

1. A machine for the deployment of the GEri PDP AuthZForce and nmon utility.
2. A machine for JMeter ver 3.0, the tool used to inject load and for simulating the client and collecting the results generated by AuthZForce.

For example, in the latest test related to version 5.3 of the GEri, all the configured VMs in a dedicated FIWARE Lab were equipped with 2 CPU 2,4 GHz with 4GB RAM and 40 GB HD.

## Overall preliminary setup ##

Once the environment necessary for the test described previously at "Testing Environmment" chapter has been setup, the following preliminary steps need to be accomplished before to start the test process:

1. Build and install AuthZForce as described in [GEri owner instructions](http://authzforce-ce-fiware.readthedocs.io/en/release-5.4.1b/InstallationAndAdministrationGuide.html#installation)
2. Create a domain as described in [GEri owner instructions](http://authzforce-ce-fiware.readthedocs.io/en/release-5.4.1b/InstallationAndAdministrationGuide.html#domain-creation). Bear in mind that the `href` value in the response message corresponds to the `domain ID` to be used for any further operation on the domain.

## Test execution - Policy decision point##

###Preliminary setup###
In the file `AZforce-policy-decision-point-150threads-1800sec.jmx` apply the following changes:

1. Set the value related to the argument `HOST` with authZForce host name or IP address value. The precise point where to apply this change can be easily found by searching the string `#authzforce hostname or IP#` and replacing it with the appropriate value.  
2. A valid domain ID (es: the one obtained during the domain creation of preliminary setup) has to be inserted in the HTTP path. This setting can be done by simply searching the string `#domainID#` within the HTTPSampler.path` parameter value and replacing it with the appropriate value.

###Testing step by step###

1. Put the file `AZforce-policy-decision-point-150threads-1800sec.jmx` in a generic working directory of the user logged into the JMeter server.
2. In order to collect system CPU, memory and network information for 300 times each 10 seconds (3.000 seconds), from a shell opened on AuthZForce server, start `nmon` utility using the command `nmon -s10 -c300 -f`. An output file having extension `.nmon` will be generated.
3. From a shell opened on JMeter server, start the test using the command `<jmeter absolute path>/jmeter.sh -n -t<working directory absolute path>/AZforce-policy-decision-point-150threads-1800sec.jmx`.  The output file `AZforce-policy-decision-point-150threads-1800sec.csv` will be created in the current directory  
4.Collect the result files once the JMeter session has finished (in 30 minutes).

### Expected results ###

This test is intended to monitor the behavior of authentication API `/domains/<domain ID>/pdp` with a growing input workload and with a stable input workload.

More in detail, these tests involve the assessment of different non functional metrics such as:

1. Response times for <n> concurrent threads
2. Number of responses per second
3. Number of Bytes per second (Throughput)
4. HTTP response codes
5. Error rate
6. Maximum threads number handled
7. CPU usage
8. Memory usage
9. Network traffic

These values can be extracted, on the one hand from the output (CSV file `AZforce-policy-decision-point-150threads-1800sec.csv`) of the execution of the JMeter test plan file (`AZforce-policy-decision-point-150threads-1800sec.jmx`), on the other hand from a tool for monitoring system resource usage such as [nmon](http://nmon.sourceforge.net/).

## Test execution - Policy decision point (stability test)##

###Preliminary setup###
In the file `AZforce-policy-decision-point-50threads-28800sec.jmx` apply the following changes:

1. Set the value related to the argument `HOST` with authZForce host name or IP address value. The precise point where to apply this change can be easily found by searching the string `#authzforce hostname or IP#` and replacing it with the appropriate value.
2. A valid domain ID (es: the one obtained during the domain creation of preliminary setup) has to be inserted in the HTTP path.The precise point where to apply this change can be easily found by searching the string `#domainID#` and replacing it with the appropriate value. 

###Testing step by step###

1. Put the file `AZforce-policy-decision-point-50threads-28800sec.jmx` in a generic working directory of user used to access to JMeter server.
2. In order to collect system CPU, memory and network information for 3000 times each 10 seconds (30.000 seconds), start `nmon` utility within AuthZForce server through the command `nmon -s10 -c3000 -f`. An output file having extension `.nmon` will be generated
3. From a shell opened on JMeter server, start the test using the command `<jmeter absolute path>/jmeter.sh -n -t<working directory absolute path>/AZforce-policy-decision-point-50threads-28800sec.jmx`.  The output file `AZforce-policy-decision-point-50threads-28800sec.csv` will be created in the current directory.
4. Collect the result files once the JMeter session has finished (8 hours).

### Expected results ###

This test is intended to monitor the behavior of authentication API `/domains/<domain ID>/pdp` with a stable input workload over a long period of time.

More in detail, this test involves the assessment of different non functional metrics such as:

1. Response times for <n> concurrent threads
2. Number of responses per second
3. Number of Bytes per second (Throughput)
4. HTTP response codes
5. Error rate
6. Maximum threads number handled
7. CPU usage
8. Memory usage
9. Network traffic

These values can be extracted, on the one hand from the output (CSV file `AZforce-policy-decision-point-50threads-28800sec.csv`) of the execution of the JMeter test plan file (`AZforce-policy-decision-point-50threads-28800sec.jmx`), on the other hand from a tool for monitoring system resource usage such as [nmon](http://nmon.sourceforge.net/).



