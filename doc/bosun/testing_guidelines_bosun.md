This project is part of FIWARE.

#BOSUN: non functional test guidelines

IoT Broker is the FIWARE reference implementation by the IoT Broker Generic Enabler by NEC and available at its GitHub repository. The description of the non functional tests carried out on this implementation is also published via the GitHub repository at Fiware/test.NonFunctional

##Testing environment

For the testing environment, is needed: 

* A machine for the deployment of the GEri to be tested, BOSUN. On this machine Python 2.7, RabbitMQ and MySQL 5.6.14 or above should be installed.
* A machine for with an BOSUN Context Broker instance (can be the same if there are enough resources). Docker version can be used.
* A machine for JMeter, the tool used to inject load and for simulating the client and collecting the results generated by BOSUN.

##Test execution

###Preliminary setup

Once the HW necessary for the test described previosly at "Testing Environmment" chapter have been setup, the following requisites need to be accomplished before to start the test process:
 
* docker installed and service up and running
* docker-compose installed
* An Openstack enviroment running.

Then, in the folder where docker-compose.yml is located, execute this command:

`sudo docker-compose up -d`

This will create a docker with the BOSUN Agent, and additional dockers for all its dependencies.

##Testing step by step

The test of BOSUN must be done in two steps:

1. Script configuration:

Depending on the scenario to execute (stress, stability), number of threads, ramp-up and test duration must be configured. Host IP must be configured too.
For this purpose, the following User Defined variables must be configured in all JMeter scripts:

* HOST -> IP to the host where BOSUN is deployed
* PORT -> Port where BOSUN is listening (by default, 8000)
* AUTH -> It's a password used to get authenticated in the system. 
* TENANT --> In this case we'll use the proves one.
* SERVER --> The server we will use.
* THREADS -> Number of threads executing the script. In the stress test, it was configured to 300, and 30 in the stability case.
* FACTS_PORT --> By default 5000
* FACTS_HOSTS --> IP to the host where the component is deployed
* FACTS_PATH --> In this case v1.0


Furthermore, the test duration must be configured. It is recommended to use the planificator from the threads group. The duration for the stress tests was 40 minutes, and 6 hours in the stability case.

Finally, in order to get the results, the path to the results file must be configured in the Simple Data Writer from the script.

2. Script execution:

For executing the script, the following command must be typed in the jmeter bin folder (We'll use 'rules.jmx' as example):

`./jmeter.sh -n -t /path/to/script/rules.jmx`

It´s recommended to execute the command in background and nohup mode:

`nohup ./jmeter.sh -n -t /path/to/script/rules.jmx &`

It´s highly recommended to use a hardware resources monitoring tool, in order to measure things like memory and CPU usages, free memory, etc.

##Expected results

As output from the script, a .dat file (in csv format) is generated. This file can be used for plotting different kinds of charts, like threads number, response times, number of errores, responses per second, etc. A plotting tool (like gnuplot) is needed in order to do this.

Additionally, if a monitoring tool has been used, then different data from it is collected too. Depending on the monitoring tool, it can generate charts directly, or it can be used another tool for plotting the output from monitoring tool (for example, sar from systat library can be used for monitoring, and k-sar tool for plotting the sar output)


